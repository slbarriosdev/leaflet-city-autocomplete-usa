<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Leaflet City Autocomplete USA - Demo</title>

  <!-- Leaflet core -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Plugin CSS -->
  <link
    rel="stylesheet"
    href="../dist/leaflet.cityAutocompleteUSA.css"
  />

  <style>
    #map {
      width: 100%;
      height: 600px;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- Plugin JS -->
  <script src="../dist/leaflet.cityAutocompleteUSA.js"></script>

  <script>
    // Initialize map
    const map = L.map("map").setView([39.8283, -98.5795], 5);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap contributors"
    }).addTo(map);

   fetch("../data/us_cities.min.json")
      .then((res) => res.json())
      .then((data) => {
        const control = L.control.cityAutocompleteUSA({
          citiesData: data,
          flyTo: true,
          showMarker: true,
          showPopup: true
        });
        control.addTo(map);
      })
      .catch((err) => console.error("‚ùå Error loading data:", err));
  </script>
  <script>
  // üîß Espera a que Leaflet agregue el buscador antes de insertar el bot√≥n "‚ùå"
  const observer = new MutationObserver(() => {
    const input = document.querySelector(".leaflet-city-autocomplete-usa input");
    if (input && !document.querySelector(".clear-btn")) {
      const clearBtn = document.createElement("span");
      clearBtn.textContent = "‚úñ";
      clearBtn.className = "clear-btn";
      input.parentElement.appendChild(clearBtn);

      input.addEventListener("input", () => {
        clearBtn.style.display = input.value.length ? "block" : "none";
      });

      clearBtn.addEventListener("click", () => {
        input.value = "";
        clearBtn.style.display = "none";
        input.focus();

        // Limpia sugerencias si hay
        const list = document.querySelector(".autocomplete-suggestions");
        if (list) list.innerHTML = "";

        // üîÅ Restablece el mapa a su vista inicial (EE. UU.)
        if (window.map) {
          map.flyTo([39.8283, -98.5795], 5, { duration: 1 });
          if (map._popup) map.closePopup();
          if (map._layers) {
            // Elimina marcador si existe
            Object.values(map._layers).forEach((layer) => {
              if (layer instanceof L.Marker) map.removeLayer(layer);
            });
          }
        }
      });

      console.log("‚úÖ Clear button added");
      observer.disconnect();
    }
  });

  // Observa el DOM hasta que aparezca el buscador
  observer.observe(document.body, { childList: true, subtree: true });
</script>



</body>
</html>
